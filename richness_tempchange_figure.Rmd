---
title: "Regional Richness Temp Change Figure"
output: html_notebook
---

```{r setup}
library(dplyr)
library(data.table)
library(ggplot2)

load("spp_master_ztemp.Rdata")
```


Sum richness values for each year, region combo
```{r sum richness values}
spp_master_richness <- spp_master_ztemp %>%
  group_by(year, reg) %>%
  summarise("richness" = sum(present), 
            "mean_sst_temp_change_abs" = mean(mean_sst_temp_change_abs), #abs change
            "max_sst_temp_change_abs" = mean(max_sst_temp_change_abs), 
            "min_sst_temp_change_abs" = mean(min_sst_temp_change_abs), 
            "mean_sbt_temp_change_abs" = mean(mean_sbt_temp_change_abs), 
            "max_sbt_temp_change_abs" = mean(max_sbt_temp_change_abs), 
            "min_sbt_temp_change_abs" = mean(min_sbt_temp_change_abs), 
            "mean_sst_temp_change" = mean(mean_sst_temp_change), #change
            "max_sst_temp_change" = mean(max_sst_temp_change), 
            "min_sst_temp_change" = mean(min_sst_temp_change), 
            "mean_sbt_temp_change" = mean(mean_sbt_temp_change), 
            "max_sbt_temp_change" = mean(max_sbt_temp_change), 
            "min_sbt_temp_change" = mean(min_sbt_temp_change), 
            "mean_sst_temp" = mean(mean_sst_temp), #raw values
            "max_sst_temp" = mean(max_sst_temp), 
            "min_sst_temp" = mean(min_sst_temp), 
            "mean_sbt_temp" = mean(mean_sbt_temp), 
            "max_sbt_temp" = mean(max_sbt_temp), 
            "min_sbt_temp" = mean(min_sbt_temp))

```
Calculate change in richness over time
```{r change in richness}
#make into data table
spp_master_richness <- data.table(spp_master_richness)

#use shift function
spp_master_richness[, "richness_change" := richness - shift(richness, n = 1, type = 'lag'), by = reg]

```

##Raw Temperature

```{r plot richness v raw temp}

#SBT
#quick linear model
sbt_max_raw <- lm(richness_change~max_sbt_temp, data = spp_master_richness)
int <- sbt_max_raw$coefficients[[1]] #yintercept
coef <- sbt_max_raw$coefficients[[2]] #temp coefficient
  
r.2<-summary(sbt_max_raw)$r.squared #correlation coefficient


ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp), col = "red", size= 0.5) +
  geom_smooth(aes(x = max_sbt_temp), method = "lm", se = F, size = 0.7, col = "darkslategrey") +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10)) +
  geom_text(aes(x=15, y = -10), label = paste("y = ", round(coef, 2), "*x + ", round(int,2), ", R^2 = ", round(r.2, 2), sep = ""), size = 3)

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sbt_raw.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp), col = "blue", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sbt_raw.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp), col = "grey",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sbt_raw.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp), col = "red",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sst_raw.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp), col = "blue",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sst_raw.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp), col = "grey", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sst_raw.jpg")
```


##Change in Temperature

Make plot for all regions together
```{r plot richness v temp change}
#SBT

#quick linear model
sbt_max_change <- lm(richness_change~max_sbt_temp_change, data = spp_master_richness)
int <- sbt_max_change$coefficients[[1]] #yintercept
coef <- sbt_max_change$coefficients[[2]] #temp coefficient
  
r.2<-summary(sbt_max_change)$r.squared #correlation coefficient

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change), col = "red", size= 0.5) +
  geom_smooth(aes(x = max_sbt_temp_change), method = "lm", se = F, size = 0.7, col = "darkslategrey") +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10)) +
  geom_text(aes(x=1, y = -10), label = paste("y = ", round(coef, 2), "*x + ", round(int,2), ", R^2 = ", round(r.2, 2), sep = ""), size = 3)


ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sbt.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change), col = "blue", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sbt.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change), col = "grey",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sbt.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change), col = "red",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sst.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change), col = "blue",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sst.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change), col = "grey", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sst.jpg")
```

Make plot for each region separately
```{r plot richness v temp change by region independently}
#SBT
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sbt_change.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sbt_change.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sbt_change.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sst_change.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sst_change.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sst_change.jpg")

```

##Absolute Change in Temperature

Make plot for all regions together
```{r plot richness v absolute temp change}
#SBT

#quick linear model
sbt_max_change_abs <- lm(richness_change~max_sbt_temp_change_abs, data = spp_master_richness)
int <- sbt_max_change_abs$coefficients[[1]] #yintercept
coef <- sbt_max_change_abs$coefficients[[2]] #temp coefficient
  
r.2<-summary(sbt_max_change_abs)$r.squared #correlation coefficient


ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change_abs), col = "red", size= 0.5) +
  geom_smooth(aes(x = max_sbt_temp_change_abs), method = "lm", se = F, size = 0.7, col = "darkslategrey") +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10)) +
  geom_text(aes(x=4, y = -10), label = paste("y = ", round(coef, 2), "*x + ", round(int,2), ", R^2 = ", round(r.2, 2), sep = ""), size = 3)

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sbt_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change_abs), col = "blue", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sbt_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change_abs), col = "grey",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sbt_change_abs.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change_abs), col = "red",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sst_change_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change_abs), col = "blue",size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_min_sst_change_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change_abs), col = "grey", size = 0.5) +
  labs(y = "Raw Richness Change (spp/yr)") +
  geom_hline(aes(yintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 10))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_mean_sst_change_change_abs.jpg")
```

Make plot for each region separately
```{r plot richness v absolute temp change by region independently}
#SBT
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change_abs), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sbt_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change_abs), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sbt_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change_abs), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sbt_change_abs.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change_abs), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sst_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change_abs), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sst_change_abs.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change_abs), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change (spp/yr)") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sst_change_abs.jpg")

```
##Malin's way: average trends over all years
```{r functions}

trend <- function(y, x){ #function to extract coefficient
	return(coef(lm(y ~ x))[2])
}

scale <- function(x){ # function to scale by (ni-nmean)/sdn
	return((x-mean(x))/sd(x))
}

```

Add trends and new variables
```{r trends and new var}
#raw
spp_master_richness[,bt_trend_max_raw:=mean(max_sbt_temp), by=reg]
spp_master_richness[,bt_trend_min_raw:=mean(min_sbt_temp), by=reg]
spp_master_richness[,bt_trend_mean_raw:=mean(mean_sbt_temp), by=reg]

spp_master_richness[,bt_trend_max_raw_sc:=scale(bt_trend_max_raw)] 
spp_master_richness[,bt_trend_min_raw_sc:=scale(bt_trend_min_raw)] 
spp_master_richness[,bt_trend_mean_raw_sc:=scale(bt_trend_mean_raw)]

#change
spp_master_richness[,bt_trend_max_change:=trend(max_sbt_temp_change,year), by=reg]
spp_master_richness[,bt_trend_min_change:=trend(min_sbt_temp_change,year), by=reg]
spp_master_richness[,bt_trend_mean_change:=trend(mean_sbt_temp_change,year), by=reg]

spp_master_richness[,bt_trend_max_change_sc:=scale(bt_trend_max_change)] 
spp_master_richness[,bt_trend_min_change_sc:=scale(bt_trend_min_change)] 
spp_master_richness[,bt_trend_mean_change_sc:=scale(bt_trend_mean_change)]

#OR
#abs change
spp_master_richness[,bt_trend_max_abs_change:=abs(bt_trend_max_change), by=reg]#max bottom temp per year
spp_master_richness[,bt_trend_min_abs_change:=abs(bt_trend_min_change), by=reg]#min bottom temp change per year
spp_master_richness[,bt_trend_mean_abs_change:=abs(bt_trend_mean_change), by=reg]#mean bottom temp change per year

spp_master_richness[,bt_trend_max_abs_change_sc:=scale(bt_trend_max_abs_change)] #scaled max bottom temp change per year
spp_master_richness[,bt_trend_min_abs_change_sc:=scale(bt_trend_min_abs_change)] #scaled min bottom temp change per year
spp_master_richness[,bt_trend_mean_abs_change_sc:=scale(bt_trend_mean_abs_change)] #scaled mean bottom temp change per year





spp_master_richness[,year_sc:=scale(year)] #scaled year

```

Summary data
```{r summary data}
# create summary data
trends <- spp_master_richness[,.(rich=trend(richness, year), #calculate trend in richness per year and trend in annual temp per year
                                 bt_trend_max_abs_change = mean(bt_trend_max_abs_change) , 
                                 bt_trend_min_abs_change = mean(bt_trend_min_abs_change) , 
                                 bt_trend_mean_abs_change = mean(bt_trend_mean_abs_change) ,
                                 bt_trend_max_change = mean(bt_trend_max_change) , 
                                 bt_trend_min_change = mean(bt_trend_min_change) , 
                                 bt_trend_mean_change = mean(bt_trend_mean_change) , 
                                 bt_trend_max_raw = mean(bt_trend_max_raw) ,
                                 bt_trend_min_raw = mean(bt_trend_min_raw) ,
                                 bt_trend_mean_raw = mean(bt_trend_mean_raw)), by=reg] 

```

Plot Max Change and Abs
```{r plot min}
#Raw

#raw mods for abline
raw_max_mod <- lm(rich~bt_trend_max_raw, data = trends)
summary(raw_max_mod)$r.squared
anova(raw_max_mod)$'Pr(>F)'[1]
# R^2 =  0.1420429
#p value = 0.3173871


ggplot(data = trends) +
  geom_point(aes(x = bt_trend_max_raw, y = rich, col = reg), size = 4) +
  geom_abline(intercept = raw_max_mod$coefficients[[1]], slope = raw_max_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_min_raw, y = rich), col = "blue") +
  #geom_abline(intercept = raw_min_mod$coefficients[[1]], slope = raw_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average\nMaximum Temperature (°C)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_max_raw.jpeg")
  
  
#Change


#change mods for abline
change_max_mod <- lm(rich~bt_trend_max_change, data = trends)
summary(change_max_mod)$r.squared
anova(change_max_mod)$'Pr(>F)'[1]
# R^2 = 0.1677293
#p value = 0.2736701



ggplot(data = trends) +
  geom_point(aes(x = bt_trend_max_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = change_max_mod$coefficients[[1]], slope = change_max_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_max_change, y = rich), col = "blue") +
  #geom_abline(intercept = change_min_mod$coefficients[[1]], slope = change_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Change in \nMax Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_max_change.jpeg")

#Absolute Change
#abs change mods for abline
abs_change_max_mod <- lm(rich~bt_trend_max_abs_change, data = trends)
summary(abs_change_max_mod)$r.squared
anova(abs_change_max_mod)$'Pr(>F)'[1]
# R^2 = 0.1750758
#p value = 0.2623728


ggplot(data = trends) +
  geom_point(aes(x = bt_trend_max_abs_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = abs_change_max_mod$coefficients[[1]], slope = abs_change_max_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_max_abs_change, y = rich), col = "blue") +
  #geom_abline(intercept = abs_change_min_mod$coefficients[[1]], slope = abs_change_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Absolute Change\nin Max Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_max_change_abs.jpeg")
```

Plot Min for Change and Abs
```{r min plots}
#Raw

#raw mods for abline
raw_min_mod <- lm(rich~bt_trend_min_raw, data = trends)
summary(raw_min_mod)$r.squared
anova(raw_min_mod)$'Pr(>F)'[1]
# R^2 = 0.05175603
#p value = 0.5560681



ggplot(data = trends) +
  geom_point(aes(x = bt_trend_min_raw, y = rich, col = reg), size = 4) +
  geom_abline(intercept = raw_min_mod$coefficients[[1]], slope = raw_min_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_min_raw, y = rich), col = "blue") +
  #geom_abline(intercept = raw_min_mod$coefficients[[1]], slope = raw_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average\nMinimum Temperature (°C)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_min_raw.jpeg")
  
  
#Change


#change mods for abline
change_min_mod <- lm(rich~bt_trend_min_change, data = trends)
summary(change_min_mod)$r.squared
anova(change_min_mod)$'Pr(>F)'[1]
# R squared: 0.525328
# p value: 0.02716705



ggplot(data = trends) +
  geom_point(aes(x = bt_trend_min_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = change_min_mod$coefficients[[1]], slope = change_min_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_min_change, y = rich), col = "blue") +
  #geom_abline(intercept = change_min_mod$coefficients[[1]], slope = change_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Change in \nMin Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_min_change.jpeg")

#Absolute Change
#abs change mods for abline
abs_change_min_mod <- lm(rich~bt_trend_min_abs_change, data = trends)
summary(abs_change_min_mod)$r.squared
anova(abs_change_min_mod)$'Pr(>F)'[1]
#r squared value: 0.2929706
#p value:0.1323295


ggplot(data = trends) +
  geom_point(aes(x = bt_trend_min_abs_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = abs_change_min_mod$coefficients[[1]], slope = abs_change_min_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_min_abs_change, y = rich), col = "blue") +
  #geom_abline(intercept = abs_change_min_mod$coefficients[[1]], slope = abs_change_min_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Absolute Change\nin Min Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_min_change_abs.jpeg")
```


Plot Mean for Change and Abs
```{r mean plots}
#Raw

#raw mods for abline
raw_mean_mod <- lm(rich~bt_trend_mean_raw, data = trends)
summary(raw_mean_mod)$r.squared
anova(raw_mean_mod)$'Pr(>F)'[1]
# R squared value: 0.1034685
#p value: 0.3986127


ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_raw, y = rich, col = reg), size = 4) +
  geom_abline(intercept = raw_mean_mod$coefficients[[1]], slope = raw_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_raw, y = rich), col = "blue") +
  #geom_abline(intercept = raw_mean_mod$coefficients[[1]], slope = raw_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average\nMean Temperature (°C)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_raw.jpeg")
  
  
#Change


#change mods for abline
change_mean_mod <- lm(rich~bt_trend_mean_change, data = trends)
summary(change_mean_mod)$r.squared
anova(change_mean_mod)$'Pr(>F)'[1]
#R squared: 0.3887231
#p value: 0.07280526



ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = change_mean_mod$coefficients[[1]], slope = change_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_change, y = rich), col = "blue") +
  #geom_abline(intercept = change_mean_mod$coefficients[[1]], slope = change_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Change in \nMean Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_change.jpeg")

#Absolute Change
#abs change mods for abline
abs_change_mean_mod <- lm(rich~bt_trend_mean_abs_change, data = trends)
summary(abs_change_mean_mod)$r.squared
anova(abs_change_mean_mod)$'Pr(>F)'[1]
#R Squared: 0.1413137
#P value: 0.3187339




ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_abs_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = abs_change_mean_mod$coefficients[[1]], slope = abs_change_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_abs_change, y = rich), col = "blue") +
  #geom_abline(intercept = abs_change_mean_mod$coefficients[[1]], slope = abs_change_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Absolute Change\nin Mean Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_change_abs.jpeg")
```


Plot Seasonality for Change and Abs
```{r seasonality plots}
#Raw

#raw mods for abline
trends$bt_trend_seas_raw <- trends$bt_trend_max_raw-trends$bt_trend_min_raw
raw_seas_mod <- lm(rich~(bt_trend_seas_raw), data = trends)
summary(raw_seas_mod)$r.squared
anova(raw_seas_mod)$'Pr(>F)'[1]
# R squared value: 0.3593094
#p value: 0.08800772


ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_raw, y = rich, col = reg), size = 4) +
  geom_abline(intercept = raw_mean_mod$coefficients[[1]], slope = raw_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_raw, y = rich), col = "blue") +
  #geom_abline(intercept = raw_mean_mod$coefficients[[1]], slope = raw_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average\nMean Temperature (°C)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_raw.jpeg")
  
  
#Change


#change mods for abline
trends$bt_trend_seas_change <- trends$bt_trend_max_change-trends$bt_trend_min_change
change_seas_mod <- lm(rich~(bt_trend_seas_change), data = trends)
summary(change_seas_mod)$r.squared
anova(change_seas_mod)$'Pr(>F)'[1]
[1] 0.000239069
[1] 0.9685076
#R squared: 0.3887231
#p value: 0.07280526



ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = change_mean_mod$coefficients[[1]], slope = change_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_change, y = rich), col = "blue") +
  #geom_abline(intercept = change_mean_mod$coefficients[[1]], slope = change_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Change in \nMean Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_change.jpeg")

#Absolute Change
#abs change mods for abline
abs_change_mean_mod <- lm(rich~bt_trend_mean_abs_change, data = trends)
summary(abs_change_mean_mod)$r.squared
anova(abs_change_mean_mod)$'Pr(>F)'[1]
#R Squared: 0.1413137
#P value: 0.3187339




ggplot(data = trends) +
  geom_point(aes(x = bt_trend_mean_abs_change, y = rich, col = reg), size = 4) +
  geom_abline(intercept = abs_change_mean_mod$coefficients[[1]], slope = abs_change_mean_mod$coefficients[[2]], col = "slategrey", linetype = "dashed") +
  #geom_point(aes(x = bt_trend_mean_abs_change, y = rich), col = "blue") +
  #geom_abline(intercept = abs_change_mean_mod$coefficients[[1]], slope = abs_change_mean_mod$coefficients[[2]], col = "blue") +
  labs(x = "Average Absolute Change\nin Mean Temperature (°C/yr)", y = "Average change\nin richness (spp/yr)") +
  theme_classic() +
  theme(text = element_text(size = 14))

ggsave(width = 4, height = 3.5, units = "in", path = "plots/richness_change", filename = "richness_trend_mean_change_abs.jpeg")
```
