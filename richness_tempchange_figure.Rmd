---
title: "Regional Richness Temp Change Figure"
output: html_notebook
---

```{r setup}
library(dplyr)
library(data.table)
library(ggplot2)

load("spp_master_ztemp.Rdata")
```


Sum richness values for each year, region combo
```{r sum richness values}
spp_master_richness <- spp_master_ztemp %>%
  group_by(year, reg) %>%
  summarise("richness" = sum(present), "mean_sst_temp_change" = mean(mean_sst_temp_change), "max_sst_temp_change" = mean(max_sst_temp_change), "min_sst_temp_change" = mean(min_sst_temp_change), "mean_sbt_temp_change" = mean(mean_sbt_temp_change), "max_sbt_temp_change" = mean(max_sbt_temp_change), "min_sbt_temp_change" = mean(min_sbt_temp_change))

```
Calculate change in richness over time
```{r change in richness}
#make into data table
spp_master_richness <- data.table(spp_master_richness)

#use shift function
spp_master_richness[, "richness_change" := richness - shift(richness, n = 1, type = 'lag'), by = reg]

```


Make plot for all regions together
```{r plot richness v temp change}
#SBT
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change), col = "red") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_max_sbt.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change), col = "blue") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change), col = "grey") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change), col = "red") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change), col = "blue") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change), col = "grey") +
  labs(y = "Raw Richness Change") +
  geom_hline(aes(yintercept = 0)) +
  geom_vline(aes(xintercept = 0)) +
  theme_classic() +
  theme(text = element_text(size = 20))
```

Make plot for each region separately
```{r plot richness v temp change by region independently}
#SBT
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sbt_temp_change), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sbt.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sbt_temp_change), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sbt.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sbt_temp_change), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sbt.jpg")

#SST
ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=max_sst_temp_change), col = "red", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_max_sst.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=min_sst_temp_change), col = "blue", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_min_sst.jpg")

ggplot(data = spp_master_richness, aes(y = richness_change)) +
  geom_point(aes(x=mean_sst_temp_change), col = "grey", size = 0.35) +
  geom_hline(aes(yintercept = 0), size = 0.2) +
  geom_vline(aes(xintercept = 0), size = 0.2) +
  labs(y = "Raw Richness Change") +
  facet_wrap(~reg) +
  theme_classic() +
  theme(text = element_text(size = 5))

ggsave(width = 3, height = 2.5, units = c("in"), path = "plots/richness_change", file = "richness_change_byreg_mean_sst.jpg")

```
