---
title: "Regional statistics for Supplementary Table 1"
output: html_notebook
---
```{r setup}

library(data.table)
library(ggplot2)
library(lme4)

spp_master_ztemp_seus_buoy_scaled <- readRDS(here::here("Data","Spp_master","spp_master_ztemp_seus_buoy_scaled.rds"))
spp_master_ztemp_seus_buoy.traits_scaled <- readRDS(here::here("Data","Spp_master","spp_master_ztemp_seus_buoy.traits_scaled.rds"))

```

Regional statistics fish and inverts
```{r regional stats fish and inverts}
#count arrivals by region
arrivals <- spp_master_ztemp_seus_buoy_scaled[col == 1,.N,reg]
colnames(arrivals) <- c("reg","arrivals")

#count departures by region
departures <- spp_master_ztemp_seus_buoy_scaled[now_ext == 1,.N,reg]
colnames(departures) <- c("reg","departures")

#count observations by region
counts <- spp_master_ztemp_seus_buoy_scaled[,.N,reg]
colnames(counts) <- c("reg","counts")

region_summaries <- cbind(counts, arrivals[,arrivals], departures[,departures])
colnames(region_summaries) <- c("reg", "counts", "arrivals", "departures")

region_summaries[,arrivals_per := round(arrivals/counts,4)][,departures_per := round(departures/counts,4)]

region_summaries


sum(region_summaries$departures)
```

Regional statistics fish only
```{r regional stats fish only}

#no sleeper
spp_master_ztemp_seus_buoy.traits_scaled_nosleeper <- spp_master_ztemp_seus_buoy.traits_scaled[spp != "Somniosus pacificus"]

#only observations with all three traits
arrival.reduced_annual_obs <- spp_master_ztemp_seus_buoy.traits_scaled_nosleeper[complete.cases(spp_master_ztemp_seus_buoy.traits_scaled_nosleeper[ , .(age.max_ocean_scaled, age.maturity_ocean_scaled, length.max_ocean_scaled, tl_ocean_scaled)]),]

#order by region
setkey(arrival.reduced_annual_obs, reg)
#count arrivals by region
arrivals_fish <- arrival.reduced_annual_obs[col == 1,.N,reg]
colnames(arrivals_fish) <- c("reg","arrivals")

#count departures by region
departures_fish <- arrival.reduced_annual_obs[now_ext == 1,.N,reg]
colnames(departures_fish) <- c("reg","departures")

#count observations by region
counts_fish <- arrival.reduced_annual_obs[,.N,reg]
colnames(counts_fish) <- c("reg","counts")

region_summaries_fish <- cbind(counts_fish, arrivals_fish[,arrivals], departures_fish[,departures])
colnames(region_summaries_fish) <- c("reg", "counts", "arrivals", "departures")

region_summaries_fish[,arrivals_per := round(arrivals/counts,4)][,departures_per := round(departures/counts,4)][,reg2 := reg]

sum(region_summaries_fish$counts)
sum(region_summaries_fish$arrivals)
sum(region_summaries_fish$departures)
```

